"""
Binance Derivatives Trading Options WebSocket Market Streams

OpenAPI Specification for the Binance Derivatives Trading Options WebSocket Market Streams
The version of the OpenAPI document: 1.0.0
Generated by OpenAPI Generator (https://openapi-generator.tech)

Do not edit the class manually.
"""

from pydantic import BaseModel
from typing import Callable, Optional, TypeVar, Union

from binance_common.configuration import ConfigurationWebSocketStreams
from binance_common.websocket import (
    WebSocketStreamBase,
    WebSocketConnection,
    RequestStreamHandle,
    RequestStream,
)

from .models import UserDataStreamEventsResponse


from .streams.market_api import MarketApi
from .streams.public_api import PublicApi


T = TypeVar("T", bound=BaseModel)


class DerivativesTradingOptionsWebSocketStreams(WebSocketStreamBase):
    def __init__(
        self,
        configuration: ConfigurationWebSocketStreams,
    ) -> None:
        super().__init__(configuration, True, url_paths=["market", "public", "private"])
        self.configuration = configuration

        self._marketApi = MarketApi(self)
        self._publicApi = PublicApi(self)

    async def ping_server(self, connection: WebSocketConnection):
        """Sends a ping message to the WebSocket server to check the connection status.

        Args:
            connection (WebSocketConnection): The WebSocket connection to send the ping message to.
        """

        if self.session:
            await super().ping_ws_stream(connection=connection)
        else:
            raise ValueError("WebSocket session is not initialized.")

    async def subscribe(
        self,
        streams,
        response_model: Optional[T] = None,
        stream_url: Optional[str] = None,
    ):
        """Subscribes to the specified WebSocket streams.

        Args:
            streams (list): A list of WebSocket streams to subscribe to.
            response_model (Optional[T]): The Pydantic model to validate the response against.
        """

        await super().subscribe(
            streams, response_model=response_model, stream_url=stream_url
        )

    async def unsubscribe(self, streams):
        """Unsubscribes from the specified WebSocket streams.

        Args:
            streams (list): A list of WebSocket streams to unsubscribe from.
        """

        await super().unsubscribe(streams)

    def on(self, event: str, callback: Callable[[T], None], stream: str):
        """Registers a callback function for a specific WebSocket event.

        Args:
            event (str): The event type to listen for (e.g., 'message', 'error').
            callback (Callable[[T], None]): The callback function to be called when the event occurs.
            stream (str): The specific WebSocket stream to listen to.
        """

        super().on(event, callback, stream)

    async def list_subscribe(self) -> dict:
        """Lists all currently subscribed WebSocket streams.

        Returns:
            dict: A dictionary containing the current subscriptions.
        """

        return await super().list_subscribe()

    async def close_connection(
        self, connection: WebSocketConnection = None, close_session: bool = True
    ):
        """Closes the WebSocket connection and optionally the session.

        Args:
            connection (WebSocketConnection, optional): The WebSocket connection to close. If None, the current session's connection is used.
            close_session (bool, optional): Whether to close the session after closing the connection. Defaults to True.
        """

        await super().close_connection(connection, close_session)

    async def user_data(self, listenKey: str) -> RequestStreamHandle:
        """Subscribe to User Data Stream (USER_STREAM)

        Args:
            listenKey (str): The listen key for the user data stream.
        Returns:
            RequestStreamHandle: An instance of RequestStream that provides the on() and unsubscribe() methods.
        """

        return await RequestStream(
            self,
            listenKey,
            response_model=UserDataStreamEventsResponse,
            stream_url="private",
        )

    async def index_price_streams(
        self,
        id: Optional[int] = None,
    ) -> RequestStreamHandle:
        r"""
                Index Price Streams

                Underlying(e.g ETHUSDT) index stream.

        Update Speed: 1000ms

                Args:
                    id (Optional[int] = None): Unique WebSocket request ID.

                Returns:
                    RequestStreamHandle

                Raises:
                    RequiredError: If a required parameter is missing.

        """

        return await self._marketApi.index_price_streams(id)

    async def kline_candlestick_streams(
        self,
        symbol: Union[str, None],
        interval: Union[str, None],
        id: Optional[int] = None,
    ) -> RequestStreamHandle:
        r"""
                Kline/Candlestick Streams

                The Kline/Candlestick Stream push updates to the current klines/candlestick every 1000 milliseconds (if existing).

        Update Speed: 1000ms

                Args:
                    symbol (Union[str, None]): The symbol parameter
                    interval (Union[str, None]): The interval parameter
                    id (Optional[int] = None): Unique WebSocket request ID.

                Returns:
                    RequestStreamHandle

                Raises:
                    RequiredError: If a required parameter is missing.

        """

        return await self._marketApi.kline_candlestick_streams(symbol, interval, id)

    async def mark_price(
        self,
        underlying: Union[str, None],
        id: Optional[int] = None,
    ) -> RequestStreamHandle:
        r"""
                Mark Price

                The mark price for all option symbols on specific underlying asset. E.g.[btcusdt@optionMarkPrice](wss://fstream.binance.com/market/stream?streams=btcusdt@optionMarkPrice)

        Update Speed: 1000ms

                Args:
                    underlying (Union[str, None]): The underlying parameter
                    id (Optional[int] = None): Unique WebSocket request ID.

                Returns:
                    RequestStreamHandle

                Raises:
                    RequiredError: If a required parameter is missing.

        """

        return await self._marketApi.mark_price(underlying, id)

    async def new_symbol_info(
        self,
        id: Optional[int] = None,
    ) -> RequestStreamHandle:
        r"""
                New Symbol Info

                New symbol listing stream.

        Update Speed: 50ms

                Args:
                    id (Optional[int] = None): Unique WebSocket request ID.

                Returns:
                    RequestStreamHandle

                Raises:
                    RequiredError: If a required parameter is missing.

        """

        return await self._marketApi.new_symbol_info(id)

    async def open_interest(
        self,
        expiration_date: Union[str, None],
        id: Optional[int] = None,
    ) -> RequestStreamHandle:
        r"""
                Open Interest

                Option open interest for specific underlying asset on specific expiration date. E.g.[ethusdt@openInterest@221125](wss://fstream.binance.com/market/stream?streams=ethusdt@openInterest@221125)

        Update Speed: 60s

                Args:
                    expiration_date (Union[str, None]): The expirationDate parameter
                    id (Optional[int] = None): Unique WebSocket request ID.

                Returns:
                    RequestStreamHandle

                Raises:
                    RequiredError: If a required parameter is missing.

        """

        return await self._marketApi.open_interest(expiration_date, id)

    async def diff_book_depth_streams(
        self,
        symbol: Union[str, None],
        id: Optional[int] = None,
        update_speed: Optional[str] = None,
    ) -> RequestStreamHandle:
        r"""
                Diff Book Depth Streams

                Bids and asks, pushed every 500 milliseconds, 100 milliseconds (if existing)

        Update Speed: 100ms or 500ms

                Args:
                    symbol (Union[str, None]): The symbol parameter
                    id (Optional[int] = None): Unique WebSocket request ID.
                    update_speed (Optional[str] = None): WebSocket stream update speed

                Returns:
                    RequestStreamHandle

                Raises:
                    RequiredError: If a required parameter is missing.

        """

        return await self._publicApi.diff_book_depth_streams(symbol, id, update_speed)

    async def individual_symbol_book_ticker_streams(
        self,
        symbol: Union[str, None],
        id: Optional[int] = None,
    ) -> RequestStreamHandle:
        r"""
                Individual Symbol Book Ticker Streams

                Pushes any update to the best bid or ask's price or quantity in real-time for a specified symbol.

        Update Speed: Real-Time

                Args:
                    symbol (Union[str, None]): The symbol parameter
                    id (Optional[int] = None): Unique WebSocket request ID.

                Returns:
                    RequestStreamHandle

                Raises:
                    RequiredError: If a required parameter is missing.

        """

        return await self._publicApi.individual_symbol_book_ticker_streams(symbol, id)

    async def partial_book_depth_streams(
        self,
        symbol: Union[str, None],
        level: Union[str, None],
        id: Optional[int] = None,
        update_speed: Optional[str] = None,
    ) -> RequestStreamHandle:
        r"""
                Partial Book Depth Streams

                Top **<levels\>** bids and asks, Valid levels are **<levels\>** are 5, 10, 20.

        Update Speed: 100ms or 500ms

                Args:
                    symbol (Union[str, None]): The symbol parameter
                    level (Union[str, None]): The level parameter
                    id (Optional[int] = None): Unique WebSocket request ID.
                    update_speed (Optional[str] = None): WebSocket stream update speed

                Returns:
                    RequestStreamHandle

                Raises:
                    RequiredError: If a required parameter is missing.

        """

        return await self._publicApi.partial_book_depth_streams(
            symbol, level, id, update_speed
        )

    async def ticker24_hour(
        self,
        symbol: Union[str, None],
        id: Optional[int] = None,
    ) -> RequestStreamHandle:
        r"""
                24-hour TICKER

                24hr ticker info for all symbols. Only symbols whose ticker info changed will be sent.

        Update Speed: 1000ms

                Args:
                    symbol (Union[str, None]): The symbol parameter
                    id (Optional[int] = None): Unique WebSocket request ID.

                Returns:
                    RequestStreamHandle

                Raises:
                    RequiredError: If a required parameter is missing.

        """

        return await self._publicApi.ticker24_hour(symbol, id)

    async def trade_streams(
        self,
        symbol: Union[str, None],
        id: Optional[int] = None,
    ) -> RequestStreamHandle:
        r"""
                Trade Streams

                The Trade Streams push raw trade information for specific symbol or underlying asset. E.g.[btcusdt@optionTrade](wss://fstream.binance.com/public/stream?streams=btcusdt@optionTrade)

        Update Speed: 50ms

                Args:
                    symbol (Union[str, None]): The symbol parameter
                    id (Optional[int] = None): Unique WebSocket request ID.

                Returns:
                    RequestStreamHandle

                Raises:
                    RequiredError: If a required parameter is missing.

        """

        return await self._publicApi.trade_streams(symbol, id)
